<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MCQ Flashcards</title>
  <link rel="icon" href="data:," />
  <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #1e1e2f;
      --card: #2a2a40;
      --muted: #9ca3af;
      --accent: #10b981;
      --text: #f3f4f6;
      --wrong: #ef4444;
      --correct-bg: rgba(16, 185, 129, 0.2);
      --wrong-bg: rgba(239, 68, 68, 0.2);
      --shadow: rgba(0, 0, 0, 0.4);
    }

    /* Reset */
    * {
      box-sizing: border-box;
    }

    html,
    body {
      height: 100%;
      margin: 0;
      font-family: 'Inter', system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .wrap {
      max-width: 700px;
      margin: 2rem auto 3rem;
      padding: 1.5rem 2rem 2rem;
      background: var(--card);
      border-radius: 14px;
      box-shadow: 0 8px 24px var(--shadow);
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      flex-wrap: wrap;
    }

    h1 {
      font-weight: 700;
      font-size: 1.8rem;
      margin: 0;
      color: var(--accent);
      flex: 1 1 auto;
    }

    p.lead {
      flex: 2 1 300px;
      font-size: 0.95rem;
      color: var(--muted);
      margin: 0;
      white-space: pre-wrap;
      line-height: 1.4;
      font-weight: 500;
    }

    code {
      background: #333;
      padding: 6px 8px;
      border-radius: 5px;
      font-family: monospace;
      font-size: 0.95rem;
      display: block;
      margin-top: 0.5rem;
      user-select: all;
      white-space: pre-line;
    }

    .status {
      color: var(--muted);
      font-size: 0.9rem;
      min-width: 160px;
      text-align: right;
      font-weight: 600;
      user-select: none;
      flex: 0 0 auto;
    }

    label.file {
      display: inline-block;
      padding: 12px 18px;
      border-radius: 10px;
      border: 2px dashed var(--muted);
      cursor: pointer;
      color: var(--text);
      font-weight: 600;
      font-size: 1rem;
      transition: border-color 0.3s ease, background 0.3s ease;
      user-select: none;
      max-width: 220px;
      text-align: center;
    }
    label.file:hover {
      border-color: var(--accent);
      background: rgba(16, 185, 129, 0.1);
    }

    input[type='file'] {
      display: none;
    }

    .buttons {
      display: flex;
      gap: 12px;
      margin-top: 12px;
    }

    button {
      flex: 1;
      background: var(--accent);
      color: #fff;
      padding: 12px 18px;
      border-radius: 10px;
      border: none;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.5);
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
      user-select: none;
    }
    button:hover,
    button:focus {
      background-color: #0f9c6e;
      box-shadow: 0 6px 20px rgba(15, 156, 110, 0.7);
      outline: none;
    }

    button.ghost {
      background: transparent;
      border: 1.8px solid var(--muted);
      color: var(--muted);
      box-shadow: none;
      font-weight: 600;
    }
    button.ghost:hover,
    button.ghost:focus {
      border-color: var(--accent);
      color: var(--accent);
      background: rgba(16, 185, 129, 0.1);
      box-shadow: none;
      outline: none;
    }

    p.small {
      margin-top: 10px;
      color: var(--muted);
      font-size: 0.85rem;
      font-style: italic;
      font-weight: 500;
    }

    .flash-area {
      margin-top: 28px;
      display: none;
      flex-direction: column;
      gap: 1.5rem;
    }

    .question {
      font-size: 1.4rem;
      font-weight: 700;
      color: var(--text);
      user-select: none;
      padding: 8px 12px;
      background: #22243d;
      border-radius: 12px;
      box-shadow: inset 0 0 10px #0008;
    }

    .options {
      display: grid;
      gap: 14px;
    }

    .opt {
      padding: 14px 18px;
      border-radius: 12px;
      border: 1.8px solid var(--muted);
      cursor: pointer;
      user-select: none;
      background: var(--card);
      color: var(--text);
      font-size: 1.05rem;
      font-weight: 600;
      transition: all 0.25s ease;
      box-shadow: 0 4px 8px rgb(0 0 0 / 0.25);
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .opt strong {
      color: var(--accent);
      min-width: 22px;
      font-weight: 700;
      user-select: none;
    }
    .opt:hover:not(.correct):not(.wrong) {
      background: #3b3b5c;
      border-color: var(--accent);
      box-shadow: 0 6px 14px rgba(16, 185, 129, 0.3);
    }

    .opt.correct {
      background: var(--correct-bg);
      border-color: var(--accent);
      color: #10b981;
      box-shadow: 0 0 10px #10b981aa;
      font-weight: 700;
    }

    .opt.wrong {
      background: var(--wrong-bg);
      border-color: var(--wrong);
      color: #ef4444;
      box-shadow: 0 0 10px #ef4444aa;
      font-weight: 700;
    }

    .meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 16px;
      color: var(--muted);
      font-size: 0.95rem;
      font-weight: 600;
      user-select: none;
    }

    .controls-bottom {
      display: flex;
      gap: 14px;
      user-select: none;
    }

    .controls-bottom button {
      flex: 1;
      font-weight: 600;
      font-size: 0.95rem;
    }

    footer.note {
      margin-top: 28px;
      color: var(--muted);
      font-size: 0.9rem;
      text-align: center;
      user-select: none;
    }

    @media (max-width: 480px) {
      .wrap {
        margin: 1rem;
        padding: 1rem 1.2rem 1.5rem;
      }
      .question {
        font-size: 1.2rem;
      }
      .opt {
        font-size: 0.95rem;
        padding: 12px 14px;
      }
      .controls-bottom {
        flex-direction: column;
        gap: 8px;
      }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>MCQ Flashcards</h1>
      <p class="lead">
        Upload a .docx with MCQs in this format:
        <code>
Question: Who wrote Hamlet?
a) Charles Dickens
b) William Shakespeare
c) Mark Twain
d) Jane Austen
Answer: b
        </code>
      </p>
      <div class="status" id="status">Idle</div>
    </header>

    <label class="file" for="fileInput">Choose .docx<input id="fileInput" type="file" accept=".docx" /></label>
    <div class="buttons">
      <button id="processBtn" class="ghost">Process</button>
      <button id="resetBtn" class="ghost">Reset</button>
    </div>
    <p class="small">Questions followed by a/b/c/d options and an Answer: line.</p>

    <div class="flash-area" id="flashArea">
      <div class="question" id="questionText"></div>
      <div class="options" id="optionsList"></div>
      <div class="meta">
        <div>
          Progress: <span id="progress">0/0</span> | Score: <span id="score">0</span>
        </div>
        <div class="controls-bottom">
          <button id="prevBtn" class="ghost">Previous</button>
          <button id="nextBtn" class="ghost">Next</button>
          <button id="shuffleBtn" class="ghost">Reshuffle</button>
        </div>
      </div>
    </div>

    <footer class="note">This runs fully in your browser. No data is uploaded.</footer>
  </div>

  <script src="https://unpkg.com/mammoth/mammoth.browser.min.js"></script>
  <script>
    const $ = (s) => document.querySelector(s);
    const status = (t) => {
      $("#status").textContent = t;
    };
    let cards = [],
      idx = 0,
      score = 0,
      answered = false;

    const shuffle = (a) => {
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
    };

    function parseQuestions(text) {
      const normalized = text.replace(/\r\n/g, "\n").replace(/\r/g, "\n");
      const rawBlocks = normalized.split(/Question:/i).filter((b) => b.trim() !== "");
      const questions = [];

      rawBlocks.forEach((block) => {
        const lines = block
          .split("\n")
          .map((l) => l.trim())
          .filter((l) => l);

        if (lines.length < 2) return;

        const questionText = lines[0];
        const options = [];
        let answerLetter = null;

        lines.slice(1).forEach((line) => {
          if (/^[a-d]\)/i.test(line)) {
            options.push(line);
          } else if (/^Answer:/i.test(line)) {
            answerLetter = line.split(":")[1].trim().toLowerCase();
          }
        });

        if (questionText && options.length === 4 && answerLetter) {
          questions.push({
            question: questionText,
            options: options,
            correctIndex: answerLetter.charCodeAt(0) - 97,
          });
        }
      });

      return questions;
    }

    function renderCard() {
      answered = false;
      const c = cards[idx];
      $("#questionText").textContent = c.question;
      const optsDiv = $("#optionsList");
      optsDiv.innerHTML = "";
      const opts = [...c.options];
      shuffle(opts);
      opts.forEach((optText) => {
        const div = document.createElement("div");
        div.className = "opt";
        div.innerHTML = `<strong>${optText[0].toUpperCase()}.</strong> ${optText.slice(3)}`;
        div.onclick = () => {
          if (answered) return;
          answered = true;

          const clickedIndex = opts.indexOf(optText);
          const correctOptText = c.options[c.correctIndex];

          if (clickedIndex === opts.indexOf(correctOptText)) {
            div.classList.add("correct");
            score++;
          } else {
            div.classList.add("wrong");
            // Show correct option
            for (const child of optsDiv.children) {
              if (child.textContent.trim() === correctOptText) {
                child.classList.add("correct");
              }
            }
          }
          $("#score").textContent = score;
        };
        optsDiv.appendChild(div);
      });
      $("#progress").textContent = `${idx + 1}/${cards.length}`;
    }

    function processDocument(file) {
      status("Reading...");
      const r = new FileReader();
      r.onload = (e) => {
        mammoth
          .extractRawText({ arrayBuffer: e.target.result })
          .then((result) => {
            cards = shuffleArray(parseQuestions(result.value));
            if (cards.length === 0) {
              status("No valid questions found. Please check file format.");
              return;
            }
            idx = 0;
            score = 0;
            status(`Loaded ${cards.length} MCQs`);
            $("#flashArea").style.display = "flex";
            renderCard();
          })
          .catch(() => status("Error processing file."));
      };
      r.readAsArrayBuffer(file);
    }

    $("#processBtn").onclick = () => {
      const f = $("#fileInput").files[0];
      if (!f) return status("Choose a file");
      processDocument(f);
    };
    $("#resetBtn").onclick = () => {
      $("#flashArea").style.display = "none";
      cards = [];
      idx = 0;
      score = 0;
      status("Idle");
      $("#score").textContent = 0;
      $("#progress").textContent = "0/0";
    };
    $("#nextBtn").onclick = () => {
      if (idx < cards.length - 1) {
        idx++;
        renderCard();
      }
    };
    $("#prevBtn").onclick = () => {
      if (idx > 0) {
        idx--;
        renderCard();
      }
    };
    $("#shuffleBtn").onclick = () => {
      shuffle(cards);
      idx = 0;
      renderCard();
      status("Shuffled");
    };

    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }
  </script>
</body>
</html>
